<!DOCTYPE html>
<html>
<head>
    <title>map-client</title>
    <meta charset="utf-8">

<!-- 
    <link rel="stylesheet" type="text/css" href="ext-4.2.1/resources/css/ext-all-neptune.css">
         -->
    <link rel="stylesheet" type="text/css" href="../../libs/ext-theme-oep/oepTheme-all.css">

    <link rel="stylesheet" type="text/css" href="../resources/css/OpenEMap.css">
    <script type="text/javascript" src="../../libs/OpenLayers-2.13.1/lib/OpenLayers.js"></script>  
    <script type="text/javascript" src="../../libs/ext-4.2.1/ext-debug.js"></script>
    <script type="text/javascript" src="../../libs/ext-4.2.1/ext-theme-neptune.js"></script>
    <script type="text/javascript" src="../../libs/ext-4.2.1/locale/ext-lang-sv_SE.js"></script>
    
    
    <script type="text/javascript">
	  Ext.Loader.setConfig({
	    disableCaching: false,
	    paths: {
	        OpenEMap: '../src/main/javascript',
	        GeoExt: '../../libs/geoext-2.0.1/src/GeoExt'
	    }
	  });
    </script> 
    
    <script type="text/javascript" src="../../libs/es5-shim.min.js"></script>
    <!--script type="text/javascript" src="geoext2-all.js"></script-->
    
    <script type="text/javascript" src="../src/main/javascript/Client.js"></script>
    
    <script type="text/javascript">
	  Ext.onReady(function() {
		
		OpenEMap.basePathImages = '../resources/images/';
		
		mapClient = Ext.create('OpenEMap.Client');
		  
		function init(name) {
		    Ext.Ajax.request({
		    	url: name,
		    	success: function(response) {
		    		var config = Ext.decode(response.responseText);

		    		// moch municipality
		    		config.options = {};
		    		config.options.municipalities = ['Sundvsall', 'Timr√•'];
		    		
		    		var gui = {
		    			//map: {
		    			//    renderTo: 'map'
		    			//},
		    			toolbar: {
		    			},
		    			zoomTools: {},
		    			//legend: {},
		    			layers: {
		    			},
		    		    searchFastighet: {
		    				zoom: 10
		    			},
		    			searchCoordinate: {
		    				// renderTo: 'searchcoordinate',
		    				listeners: {
		    				    searchcomplete: function(e) {
		    				        console.log('searchCoordinate searchcomplete ' + e);
		    				    }
		    				}
		    			},
		    			objectConfig: {x : 10, y: 10},
		    			baseLayers: {}
		    		};
		    	
		    		mapClient.destroy();
		    		mapClient.configure(config, {
		    			gui: gui
		    		});
		    		delete config.options.municipalities;
		    		delete config.options;
		    		
	    	          var labels = new OpenLayers.Rule({
                          filter: new OpenLayers.Filter.Comparison({
                              type: OpenLayers.Filter.Comparison.EQUAL_TO,
                              property: "type",
                              value: "label",
                          }),
                            symbolizer: {
                              pointRadius: 20,
                              fillOpacity: 0,
                              strokeOpacity: 0,
                              label: "${label}"   
                           }
                          });
	    	          
	    	          mapClient.drawLayer.styleMap.styles['default'].addRules([labels]);
	    	          
	    	          mapClient.drawLayer.events.register('featuremodified', null, function() {
	    	              console.log("featuremodified triggered");
	    	          });
		    	}
		    });
		}
	    
	    var combo = Ext.create('Ext.form.ComboBox',  {
			renderTo: 'configcombo',
			store: ['config_EPSG3014.json',
					'config.json',
			        'riges.json',
			        'eldstad.json',
			        'situationsplan.json',
			        'komplementbyggnad.json',
			        'transformator.json',
			        'forhandsbesked.json',
			        'preview.json',
			        'detaljplaner.json',
			        'OSM.json',
			        'testAll.json'],
			queryMode: 'local',
			listeners: {
				"select": function(combo, records) {
					var record = records[0];
					init('../config/' + record.get(record.fields.get(0).name));
				}
			}
		});
	    
	    var record = combo.store.getAt(0);
	    combo.setValue(record);
	    combo.fireEvent('select', combo, [record]);
	  });
    </script>
    
    <script type="text/javascript" src="../src/main/javascript/locale/OpenEMap-lang-sv_SE.js"></script>
</head>
<body>

<div id="configcombo" style="position: absolute; bottom: 0; left: 0"></div>

<div id="toolbar"></div>
<div id="map" style="position: absolute; left: 120px; width: 100%; height: 650px"></div>
<div id="layers"></div>
<div id="searchfastighet"></div>
<div id="searchcoordinate"></div>

</body>
</html>
