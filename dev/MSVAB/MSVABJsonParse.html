<html>
<head>
<script type="text/javascript" src="/libs/ext-4.2.1/ext-all-debug.js"></script>
<script type="text/javascript" src="/libs/ext-4.2.1/ext-theme-neptune.js"></script>
<script type="text/javascript" src="/libs/ext-4.2.1/locale/ext-lang-sv_SE.js"></script>
<script>
/*
var text = '';
text += '{';
text += '	"displayFieldName":"REQUESTID",';
text += '	"objectIdFieldName":"REQUESTID",';
text += '	"globalIdFieldName":"",';
text += '	"geometryType":"esriGeometryPoint",';
text += '	"spatialReference":{';
text += '		"wkid":3014,';
text += '		"latestWkid":0,';
text += '		"vcsWkid":0,';
text += '		"latestVcsWkid":0,';
text += '		"wkt":""';
text += '	},';
text += '	"fields":[';
text += '		{';
text += '			"name":"REQUESTID",';
text += '			"type":"esriFieldTypeOID","alias":"REQUESTID","required":true,"editable":false,"length":-1.0,"domain":null,"Tag":null,"localizedNames":{}';
text += '		},';
text += '		{"name":"DateTimeInit","type":"esriFieldTypeDate","alias":"Date Initiated","required":false,"editable":false,"length":-1.0,"domain":null,"Tag":null,"localizedNames":{}},';
text += '		{"name":"Description","type":"esriFieldTypeString","alias":"Description","required":false,"editable":false,"length":-1.0,"domain":null,"Tag":null,"localizedNames":{}},';
text += '		{"name":"ProbAddress","type":"esriFieldTypeString","alias":"Address","required":false,"editable":false,"length":-1.0,"domain":null,"Tag":null,"localizedNames":{}},';
text += '		{"name":"MapPage","type":"esriFieldTypeString","alias":"Map Page","required":false,"editable":false,"length":-1.0,"domain":null,"Tag":null,"localizedNames":{}},';
text += '		{"name":"Details","type":"esriFieldTypeString","alias":"Details","required":false,"editable":false,"length":-1.0,"domain":null,"Tag":null,"localizedNames":{}},';
text += '		{"name":"Status","type":"esriFieldTypeString","alias":"Status","required":false,"editable":false,"length":-1.0,"domain":null,"Tag":null,"localizedNames":{}},';
text += '		{"name":"DomainId","type":"esriFieldTypeInteger","alias":"Domain","required":false,"editable":false,"length":-1.0,"domain":null,"Tag":null,"localizedNames":{}},';
text += '		{"name":"SRX","type":"esriFieldTypeDouble","alias":"X","required":true,"editable":false,"length":-1.0,"domain":null,"Tag":null,"localizedNames":{}},';
text += '		{"name":"SRY","type":"esriFieldTypeDouble","alias":"Y","required":true,"editable":false,"length":-1.0,"domain":null,"Tag":null,"localizedNames":{}}';
text += '	],';
text += '	"features":[';
text += '		{';
text += '			"attributes":{';
text += '				"REQUESTID":15112,';
text += '				"DateTimeInit":1427363820840,';
text += '				"Description":"Driftstörning",';
text += '				"ProbAddress":"Repslagarevägen 28",';
text += '				"MapPage":"SUNDSVALL",';
text += '				"Details":"OBS! Testärende driftstörning visas externt",';
text += '				"Status":"MOTTAGEN",';
text += '				"DomainId":1,';
text += '				"SRX":152187.87,';
text += '				"SRY":6921023.32';
text += '			},';
text += '			"geometry":{';
text += '				"geometryType":"MapPoint",';
text += '				"spatialReference":{';
text += '					"wkid":102100,';
text += '					"latestWkid":0,';
text += '					"vcsWkid":0,';
text += '					"latestVcsWkid":0,';
text += '					"wkt":null';
text += '				},';
text += '				"extent":{';
text += '					"xmin":1924970.50067609,';
text += '					"ymin":8953566.73002223,';
text += '					"xmax":1924970.50067609,';
text += '					"ymax":8953566.73002223,';
text += '					"spatialReference":{';
text += '						"wkid":102100,';
text += '						"latestWkid":0,';
text += '						"vcsWkid":0,';
text += '						"latestVcsWkid":0,';
text += '						"wkt":""';
text += '					},';
text += '					"isEmpty":false';
text += '				},';
text += '				"x":1924970.50067609,';
text += '				"y":8953566.73002223';
text += '			}';
text += '		},';
text += '		{';
text += '			"attributes":{"REQUESTID":15111,"DateTimeInit":1427363516693,"Description":"Akuthändelse","ProbAddress":"Repslagarevägen 24","MapPage":"SUNDSVALL","Details":"OBS! Test ärende akut händelse","Status":"MOTTAGEN","DomainId":1,"SRX":152284.42,"SRY":6921003.22},"geometry":{"geometryType":"MapPoint","spatialReference":{"wkid":102100,"latestWkid":0,"vcsWkid":0,"latestVcsWkid":0,"wkt":null},"extent":{"xmin":1925178.29025853,"ymin":8953523.26410752,"xmax":1925178.29025853,"ymax":8953523.26410752,"spatialReference":{"wkid":102100,"latestWkid":0,"vcsWkid":0,"latestVcsWkid":0,"wkt":""},"isEmpty":false},"x":1925178.29025853,"y":8953523.26410752}},{"attributes":{"REQUESTID":15114,"DateTimeInit":1427364111057,"Description":"Underhållsarbeten","ProbAddress":"Ludvigsbergsvägen 19","MapPage":"SUNDSVALL","Details":"OBS! Testärende underhållsarbete","Status":"MOTTAGEN","DomainId":1,"SRX":152385.68,"SRY":6921070.79},"geometry":{"geometryType":"MapPoint","spatialReference":{"wkid":102100,"latestWkid":0,"vcsWkid":0,"latestVcsWkid":0,"wkt":null},"extent":{"xmin":1925396.34988861,"ymin":8953668.76383604,"xmax":1925396.34988861,"ymax":8953668.76383604,"spatialReference":{"wkid":102100,"latestWkid":0,"vcsWkid":0,"latestVcsWkid":0,"wkt":""},"isEmpty":false},"x":1925396.34988861,"y":8953668.76383604}},{"attributes":{"REQUESTID":15113,"DateTimeInit":1427363947497,"Description":"Projektarbeten","ProbAddress":"Repslagarevägen 18E","MapPage":"SUNDSVALL","Details":"OBS! Testärende Projektarbete","Status":"MOTTAGEN","DomainId":1,"SRX":152416.0,"SRY":6920983.0},';
text += '			"geometry":{';
text += '				"geometryType":"MapPoint","spatialReference":{';
text += '					"wkid":102100,"latestWkid":0,"vcsWkid":0,"latestVcsWkid":0,"wkt":null';
text += '				},';
text += '				"extent":{';
text += '					"xmin":1925461.47659162,"ymin":8953479.47962199,"xmax":1925461.47659162,"ymax":8953479.47962199,"spatialReference":{"wkid":102100,"latestWkid":0,"vcsWkid":0,"latestVcsWkid":0,"wkt":""},"isEmpty":false';
text += '				},';
text += '				"x":1925461.47659162,';
text += '				"y":8953479.47962199';
text += '			}';
text += '		}';
text += '	],';
text += '	"fieldAliases":{"REQUESTID":"REQUESTID","DateTimeInit":"Date Initiated","Description":"Description","ProbAddress":"Address","MapPage":"Map Page","Details":"Details","Status":"Status","DomainId":"Domain","SRX":"X","SRY":"Y"},"count":4';
text += '}';
*/

Ext.define('Features', {
    extend: 'Ext.data.Model',
    fields: ['features']
});

var proxy = new Ext.data.proxy.Ajax({
    url: 'MSVABGeoJSON.json',
    reader: 'json', 
    model: 'Features'
});
var operation = new Ext.data.Operation({
    action: 'read'
}); 

proxy.read(operation, handleResponse);

var geojson = { 
	"type": "FeatureCollection",    
	"features": []
}

function handleResponse(text) {
	var features = text.resultSet.records[0].data.features; //JSON.parse(text);
	var geojsonProjekt = {"type": "FeatureCollection","features": []};
	var geojsonDriftstorning = {"type": "FeatureCollection","features": []};
	var geojsonUnderhall = {"type": "FeatureCollection","features": []};
	var geojsonAkut = {"type": "FeatureCollection","features": []};
	features.forEach(function(feature) {
		var popupText = feature.attributes.Details + '<br>' + feature.attributes.DateTimeInit + '<br>' + feature.attributes.ProbAddress; 
		var feat = {
			"geometry": {
				"type": "Point", 
				"coordinates": [
					feature.attributes.SRX, 
					feature.attributes.SRY
				]
			}, 
			"properties": {"popupText": popupText}};
		switch (feature.attributes.Description) {
			case 'Driftstörning':
				geojsonDriftstorning.features.push(feat);
				break;
			case 'Akuthändelse':
				geojsonAkut.features.push(feat);
				break;
			case 'Projektarbeten': 
				geojsonProjekt.features.push(feat);
				break;
			default:
				geojsonUnderhall.features.push(feat);
		}
	});
}
</script>
</head>
<body>
</body>
</html>