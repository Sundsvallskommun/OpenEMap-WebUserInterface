<!DOCTYPE html>
<html lang="sv">
	<head>
		<meta http-equiv="Content-type" content="text/html; charset=UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		
<!--	    <link rel="stylesheet" type="text/css" href="/libs/ext-theme-oep/release/ext-theme-oep-1.0.0/oepTheme-all.css">
	    <link rel="stylesheet" type="text/css" href="/OpenEMap-WebUserInterface/resources/css/OpenEMap.css">
	
	    <script type="text/javascript" src="/libs/OpenLayers-2.13.1/lib/OpenLayers.js"></script>  
	    <script type="text/javascript" src="/libs/ext-4.2.1/ext-all.js"></script>
	    <script type="text/javascript" src="/libs/ext-4.2.1/ext-theme-neptune.js"></script>
	    <script type="text/javascript" src="/libs/ext-4.2.1/locale/ext-lang-sv_SE.js"></script>
	    <script type="text/javascript" src="/libs/proj4js/proj4-compressed.js"></script>
	    <script type="text/javascript" src="/libs/proj4js/proj4_defs.js"></script>
	    <script type="text/javascript">
		  Ext.Loader.setConfig({
		    disableCaching: false,
		    paths: {
		        OpenEMap: '../../src/main/javascript',
		        GeoExt: '../../../libs/geoext-2.0.1/src/GeoExt'
		    }
		  });
	    </script> 
-->
	    <!-- This will make the page reload automatically when source has changed and page is served using grunt devserver -->
	    <script src="//localhost:35729/livereload.js"></script>

	    <script type="text/javascript">
	    var debug='source';
	    var devPath = '../../';
	    </script> 
	    <script type="text/javascript" src="../../src/main/javascript/OpenEMap.js"></script>
	    <script type="text/javascript" src="popupLayerGeojson.js"></script>
	

	    <script type="text/javascript">
	    function callback(mapClient) {
			var head = document.getElementsByTagName("head")[0];
			var script = {};
			script = document.createElement('script');
			script.type = 'text/javascript';
		 	script.src = 'popupLayerStyles.js';
			head.appendChild(script);

			function createPopupLayer() {
	            // Create objects in map based on GeoJSON, see brandlarmGeojson.js with style specified in brandlarmStyles.js
				popupLayer = mapClient.addPopupLayer(geojson, 'Popup layer example', 'id', 'popupText', '', '', 'popupTitle', stylemapGraphics, 'EPSG:3006', true);
	            // Create objects in map based on GeoJSON, see brandlarmGeojson.js with style specified in brandlarmStyles.js
				popupLayer2 = mapClient.addPopupLayer(geojson2, 'Popup layer example 2', 'id', null, '', '', 'popupTitle', stylemapGraphics, 'EPSG:3006', true);
	
	            // Listen to event for feature selected
				mapClient.map.events.register('popupfeatureselected', this, function(arg) {
	            	console.log('Feature in layer ' + arg.layer.name + ' with id ' + arg.featureid + ' was selected.');
				});
	            // Listen to event for feature unselected
	            mapClient.map.events.register('popupfeatureunselected', this, function(arg) {
	                console.log('Feature in layer ' + arg.layer.name + ' with id ' + arg.featureid + ' was unselected.');
	            });
	            // Showing object with id=1
	            mapClient.showPopupFeature(popupLayer, 5, true);
	            mapClient.showPopupFeature(popupLayer, 1, true);
	            mapClient.showPopupFeature(popupLayer2, 9, true);
			}

			function waitUntilStyleIsLoaded(callback) {
				if (typeof stylemapGraphics !== "undefined") {
					callback();
				} else {
					setTimeout(function() { waitUntilStyleIsLoaded(callback); }, 5);
				}
			}
			
			waitUntilStyleIsLoaded(createPopupLayer);
	    }
	    
		function init(name) {
			var options = {
				gui : {
					map : false,
					toolbar : {},
					zoomTools : {},
					layers : {},
					baseLayers : {},
					searchFastighet : {},
					scalebar : {}
				},
				OpenEMap : {
					basePathImages : '../../resources/images/',
					// Base path to be used for mapfish print servlet requests
					basePathMapFish : '/mapfishprint-2.1.1/pdf',
					// Base path to be used for all AJAX requests against search-lm REST API
					basePathLM : '/search/lm/',
					// name of user to be used when calling search-lm REST API
					lmUser : 'sundsvall',
					// Base path to be used for all AJAX requests against Elasticsearch REST API
					basePathES : '/search/es/',
					// URL/paths related to WMS usage / advanced layer list
					wmsURLs : {
						// URL to be used to fetch WMS capabilities etc. for add layer
						basePath : '/geoserver/wms',
						// URL to be used when WMS layer has been added to config
						url : 'https://extmaptest.sundsvall.se/geoserver/wms',
						// URL to getcapabilities document. Must include request parameter (eg. https://extmap.sundsvall.se/geoserver/wms?request=GetCapabilities&version=1.1.1)
						getCapabilities : 'https://extmaptest.sundsvall.se/getcapabilities/wms.xml'
					},
					//Base path to proxy to be used for WFS-post
					basePathProxy : '/cgi-bin/proxy.py?url=',
					// WS paths to be used for AJAX requests
					wsUrls : {
						//basepath to Open eMap Admin
						basePath : '/openemapadmin-1.6.0',
						// relative path to configs, set in admin of modules in OpenHierarchy
						configs : '/configs',
						// relative path to adminconfigs, set in admin of modules in OpenHierarchy
						adminconfigs : '/adminconfigs',
						// path to permalinks
						permalinks : '/openemappermalink/permalinks',
						metadata : 'geometadata/getmetadatabyid',
						metadata_abstract : 'geometadata/getabstractbyid'
					},
				}
			};
			
			try {
				initOpenEMap(name, options, callback);
			} catch(msg) {
				alert(msg);
			}
		}


		init('popupLayerConfig.json');
	    </script>
	    <title>Open eMap - PopupLayer example</title>
	</head>
	<body>
    <div id="map" style="position: absolute; width: 100%; height: 650px" class="popup"/></div>
	</body>
</html>
